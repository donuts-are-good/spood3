{{define "content"}}
<div class="watch-container">
    {{if .Fight}}
        <div class="arena-header">
            <h1 class="arena-title">üé™ VIOLENCE THEATER üé™</h1>
            <div class="arena-subtitle">{{.Fight.Fighter1Name}} vs {{.Fight.Fighter2Name}}</div>
            <div class="viewer-count">
                <span id="viewer-count">0</span> degenerates watching this carnage
            </div>
        </div>

        

        <div class="arena-display">
            <div class="fighter-section fighter-left">
                <div class="fighter-portrait">
                    <div class="health-bar-container">
                        <div class="health-label">{{.Fight.Fighter1Name}}</div>
                        <div class="health-bar">
                            <div class="health-fill" id="health1" style="width: 100%"></div>
                            <div class="health-text" id="health1-text">100,000</div>
                        </div>
                    </div>
                    <div class="fighter-avatar" id="fighter1-avatar" data-fighter-id="{{.Fight.Fighter1ID}}" data-fighter-name="{{.Fight.Fighter1Name}}">
                        {{if .Fighter1}}<img src="{{.Fighter1.AvatarURL}}" alt="{{.Fight.Fighter1Name}}" class="avatar-img">{{else}}üíÄ{{end}}
                        {{if or (gt .Fighter1Blessings 0) (gt .Fighter1Curses 0)}}
                        <div class="fighter-effects overlay">
                            {{if gt .Fighter1Blessings 0}}<span class="blessing-indicator">‚ú® {{.Fighter1Blessings}}</span>{{end}}
                            {{if gt .Fighter1Curses 0}}<span class="curse-indicator">üíÄ {{.Fighter1Curses}}</span>{{end}}
                        </div>
                        {{end}}
                    </div>
                    <div class="fighter-team">{{if .Fighter1}}{{.Fighter1.Team}}{{end}}</div>
                </div>
            </div>

            <div class="arena-center">
                <div class="vs-display">VS</div>
                <div class="round-display">
                    <div class="round-label">ROUND</div>
                    <div class="round-number" id="round-number">1</div>
                </div>
                <div class="status-display" id="fight-status">
                    {{if eq .Fight.Status "scheduled"}}<span class="pill next">UPCOMING</span>
                    {{else if eq .Fight.Status "active"}}<span class="pill live">LIVE</span>
                    {{else if eq .Fight.Status "completed"}}<span class="pill completed">COMPLETED</span>
                    {{else}}<span class="pill voided">VOIDED</span>{{end}}
                </div>
                {{if .AllBets}}
                {{$f1 := 0}}
                {{$f2 := 0}}
                {{$totalAmt := 0}}
                {{range .AllBets}}
                    {{$totalAmt = add $totalAmt .Amount}}
                    {{if eq .FighterID $.Fight.Fighter1ID}}
                        {{$f1 = add $f1 1}}
                    {{else}}
                        {{$f2 = add $f2 1}}
                    {{end}}
                {{end}}
                {{$tBets := add $f1 $f2}}
                <div class="bet-summary" id="bet-summary"
                     data-f1-bets="{{$f1}}"
                     data-f2-bets="{{$f2}}"
                     data-total-amount="{{$totalAmt}}"
                     data-total-bets="{{$tBets}}">
                    <div class="bet-title">üí∞ Degenerate Betting Summary</div>
                    <div class="bet-quick">Total Wagered: <strong>{{$totalAmt}}</strong> credits ‚Ä¢ Bets: <strong>{{$tBets}}</strong></div>
                    <div class="bet-row">
                        <div class="bet-name">{{.Fight.Fighter1Name}}</div>
                        <div class="bet-bar"><div class="bet-fill-1" id="bet-fill-1" style="width: 0%"></div></div>
                        <div class="bet-num" id="bet-p1">0%</div>
                    </div>
                    <div class="bet-row">
                        <div class="bet-name">{{.Fight.Fighter2Name}}</div>
                        <div class="bet-bar"><div class="bet-fill-2" id="bet-fill-2" style="width: 0%"></div></div>
                        <div class="bet-num" id="bet-p2">0%</div>
                    </div>
                </div>
                {{end}}
            </div>

            <div class="fighter-section fighter-right">
                <div class="fighter-portrait">
                    <div class="health-bar-container">
                        <div class="health-label">{{.Fight.Fighter2Name}}</div>
                        <div class="health-bar">
                            <div class="health-fill" id="health2" style="width: 100%"></div>
                            <div class="health-text" id="health2-text">100,000</div>
                        </div>
                    </div>
                    <div class="fighter-avatar" id="fighter2-avatar" data-fighter-id="{{.Fight.Fighter2ID}}" data-fighter-name="{{.Fight.Fighter2Name}}">
                        {{if .Fighter2}}<img src="{{.Fighter2.AvatarURL}}" alt="{{.Fight.Fighter2Name}}" class="avatar-img">{{else}}üó°Ô∏è{{end}}
                        {{if or (gt .Fighter2Blessings 0) (gt .Fighter2Curses 0)}}
                        <div class="fighter-effects overlay">
                            {{if gt .Fighter2Blessings 0}}<span class="blessing-indicator">‚ú® {{.Fighter2Blessings}}</span>{{end}}
                            {{if gt .Fighter2Curses 0}}<span class="curse-indicator">üíÄ {{.Fighter2Curses}}</span>{{end}}
                        </div>
                        {{end}}
                    </div>
                    <div class="fighter-team">{{if .Fighter2}}{{.Fighter2.Team}}{{end}}</div>
                </div>
            </div>
        </div>

        <!-- Betting Information Section -->
        <div class="watch-lower">
            <div class="commentary-section">
                <div class="commentary-header">
                    <h3>üéôÔ∏è VIOLENCE BOOTH COMMENTARY</h3>
                    <div class="commentary-status" id="commentary-status">Waiting for violence...</div>
                </div>
                <div class="commentary-feed" id="commentary-feed">
                    <div class="initial-message">
                        <div class="action-text">Welcome to the Violence Theater! Prepare for maximum carnage!</div>
                        <div class="announcer-comment">
                            <span class="announcer-name">Chad Puncherson:</span>
                            "Ladies and gentlemen, we're about to witness some PREMIUM VIOLENCE!"
                        </div>
                    </div>
                </div>
            </div>

            {{if .AllBets}}
            <div class="betting-section">
                <h3>üí∞ DEGENERATE GAMBLING STATUS</h3>
                {{if .UserBet}}
                    <div class="user-bet-status">
                        <strong>Your Bet:</strong> {{.UserBet.Amount}} credits on 
                        {{if eq .UserBet.FighterID .Fight.Fighter1ID}}{{.Fight.Fighter1Name}}{{else}}{{.Fight.Fighter2Name}}{{end}}
                        {{if eq .UserBet.Status "resolved"}}
                            {{if .UserBet.Payout.Valid}}
                                - <span class="win-status">WON {{.UserBet.Payout.Int64}} credits! üéâ</span>
                            {{else}}
                                - <span class="loss-status">LOST üí∏</span>
                            {{end}}
                        {{end}}
                    </div>
                {{end}}
                
                <div class="betting-summary">
                    <div class="bet-count">{{len .AllBets}} degenerates have placed bets</div>
                    {{$fighter1Bets := 0}}
                    {{$fighter2Bets := 0}}
                    {{$totalAmount := 0}}
                    {{range .AllBets}}
                        {{$totalAmount = add $totalAmount .Amount}}
                        {{if eq .FighterID $.Fight.Fighter1ID}}
                            {{$fighter1Bets = add $fighter1Bets 1}}
                        {{else}}
                            {{$fighter2Bets = add $fighter2Bets 1}}
                        {{end}}
                    {{end}}
                    <div class="bet-stats-quick">
                        <span><strong>{{.Fight.Fighter1Name}}:</strong> {{$fighter1Bets}} bets</span> | 
                        <span><strong>{{.Fight.Fighter2Name}}:</strong> {{$fighter2Bets}} bets</span> | 
                        <span><strong>Total Wagered:</strong> {{$totalAmount}} credits</span>
                    </div>
                </div>

                <div class="detailed-bets">
                    <h4>üé≠ DEGENERATE ROSTER</h4>
                    <div class="bets-list">
                        {{range .AllBets}}
                        <div class="bet-notification {{if eq .UserID $.User.ID}}user-bet{{end}}">
                            <div class="bet-main-line">
                                <span class="bettor-name">{{getDisplayName .Username .CustomUsername}}</span>
                                <span class="bet-info">
                                    {{.Amount}} credits ‚Üí {{.FighterName}}
                                    {{if eq .Status "resolved"}}
                                        {{if .Payout.Valid}}
                                            <span class="win-badge">+{{.Payout.Int64}}</span>
                                        {{else}}
                                            <span class="loss-badge">LOST</span>
                                        {{end}}
                                    {{end}}
                                </span>
                            </div>
                            {{$userID := .UserID}}
                            {{range $.UserEffectsOnFight}}
                                {{if eq .UserID $userID}}
                                <div class="effect-notification {{if or (eq .EffectType "strength_blessing") (eq .EffectType "speed_blessing") (eq .EffectType "endurance_blessing") (eq .EffectType "technique_blessing")}}blessing-notif{{else}}curse-notif{{end}}">
                                    {{if eq .EffectType "strength_blessing"}}
                                        ‚ú® Applied strength blessing to {{.TargetName}}
                                    {{else if eq .EffectType "speed_blessing"}}
                                        ‚ú® Applied speed blessing to {{.TargetName}}
                                    {{else if eq .EffectType "endurance_blessing"}}
                                        ‚ú® Applied endurance blessing to {{.TargetName}}
                                    {{else if eq .EffectType "technique_blessing"}}
                                        ‚ú® Applied technique blessing to {{.TargetName}}
                                    {{else if eq .EffectType "strength_curse"}}
                                        üíÄ Applied strength curse to {{.TargetName}}
                                    {{else if eq .EffectType "speed_curse"}}
                                        üíÄ Applied speed curse to {{.TargetName}}
                                    {{else if eq .EffectType "endurance_curse"}}
                                        üíÄ Applied endurance curse to {{.TargetName}}
                                    {{else if eq .EffectType "technique_curse"}}
                                        üíÄ Applied technique curse to {{.TargetName}}
                                    {{else}}
                                        ‚ö° Applied {{.EffectType}} to {{.TargetName}}
                                    {{end}}
                                </div>
                                {{end}}
                            {{end}}
                        </div>
                        {{end}}
                    </div>
                </div>
            </div>
            {{end}}
        </div>

        <div class="watch-controls">
            <a href="/fight/{{.Fight.ID}}" class="control-button">‚Üê Fight Details</a>
            <a href="/" class="control-button">‚Üê Schedule</a>
        </div>

        <script src="/static/js/watch.js"></script>
        <script>
            // Initialize the Violence Theater
            document.addEventListener('DOMContentLoaded', function() {
                const fightData = {
                    id: {{.Fight.ID}},
                    status: "{{.Fight.Status}}",
                    fighter1Name: "{{.Fight.Fighter1Name}}",
                    fighter2Name: "{{.Fight.Fighter2Name}}",
                    {{if .Fight.FinalScore1.Valid}}finalHealth1: {{.Fight.FinalScore1.Int64}},{{else}}finalHealth1: 100000,{{end}}
                    {{if .Fight.FinalScore2.Valid}}finalHealth2: {{.Fight.FinalScore2.Int64}},{{else}}finalHealth2: 100000,{{end}}
                    {{if .Fight.WinnerID.Valid}}winnerID: {{.Fight.WinnerID.Int64}},
                    fighter1ID: {{.Fight.Fighter1ID}},
                    fighter2ID: {{.Fight.Fighter2ID}}{{end}}
                };
                
                initializeWatchPage({{.Fight.ID}}, fightData);
            });
        </script>
    {{else}}
        <div class="error-section">
            <h2>üíÄ VIOLENCE NOT FOUND</h2>
            <p>The requested violence event has been absorbed into the chaos void.</p>
            <div style="margin-top: 20px;">
                <a href="/" class="control-button">‚Üê Return to Schedule</a>
            </div>
        </div>
    {{end}}
</div>
{{end}} 