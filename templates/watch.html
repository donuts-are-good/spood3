{{define "content"}}
<div class="watch-container">
    {{if .Fight}}
        <div class="arena-header">
            <h1 class="arena-title">üé™ VIOLENCE THEATER üé™</h1>
            <div class="arena-subtitle">{{.Fight.Fighter1Name}} vs {{.Fight.Fighter2Name}}</div>
            <div class="viewer-count">
                <span id="viewer-count">0</span> degenerates watching this carnage
            </div>
        </div>

        <div class="commentary-section">
            <div class="commentary-header">
                <h3>üéôÔ∏è VIOLENCE BOOTH COMMENTARY</h3>
                <div class="commentary-status" id="commentary-status">Waiting for violence...</div>
            </div>
            <div class="commentary-feed" id="commentary-feed">
                <div class="initial-message">
                    <div class="action-text">Welcome to the Violence Theater! Prepare for maximum carnage!</div>
                    <div class="announcer-comment">
                        <span class="announcer-name">Chad Puncherson:</span>
                        "Ladies and gentlemen, we're about to witness some PREMIUM VIOLENCE!"
                    </div>
                </div>
            </div>
        </div>

        <div class="arena-display">
            <div class="fighter-section fighter-left">
                <div class="fighter-portrait">
                    <div class="fighter-avatar" id="fighter1-avatar" data-fighter-id="{{.Fight.Fighter1ID}}" data-fighter-name="{{.Fight.Fighter1Name}}">üíÄ</div>
                    <div class="fighter-name">{{.Fight.Fighter1Name}}</div>
                    <div class="fighter-team">{{if .Fighter1}}{{.Fighter1.Team}}{{end}}</div>
                    {{if or (gt .Fighter1Blessings 0) (gt .Fighter1Curses 0)}}
                        <div class="fighter-effects">
                            {{if gt .Fighter1Blessings 0}}<span class="blessing-indicator">‚ú® {{.Fighter1Blessings}}</span>{{end}}
                            {{if gt .Fighter1Curses 0}}<span class="curse-indicator">üíÄ {{.Fighter1Curses}}</span>{{end}}
                        </div>
                    {{end}}
                </div>
                <div class="health-bar-container">
                    <div class="health-label">HEALTH</div>
                    <div class="health-bar">
                        <div class="health-fill" id="health1" style="width: 100%"></div>
                        <div class="health-text" id="health1-text">100,000</div>
                    </div>
                </div>
            </div>

            <div class="arena-center">
                <div class="vs-display">VS</div>
                <div class="round-display">
                    <div class="round-label">ROUND</div>
                    <div class="round-number" id="round-number">1</div>
                </div>
                <div class="status-display" id="fight-status">
                    {{if eq .Fight.Status "scheduled"}}‚è±Ô∏è VIOLENCE PENDING
                    {{else if eq .Fight.Status "active"}}üî¥ LIVE VIOLENCE
                    {{else if eq .Fight.Status "completed"}}‚úÖ VIOLENCE COMPLETE
                    {{else}}‚ùå VOIDED{{end}}
                </div>
            </div>

            <div class="fighter-section fighter-right">
                <div class="fighter-portrait">
                    <div class="fighter-avatar" id="fighter2-avatar" data-fighter-id="{{.Fight.Fighter2ID}}" data-fighter-name="{{.Fight.Fighter2Name}}">üó°Ô∏è</div>
                    <div class="fighter-name">{{.Fight.Fighter2Name}}</div>
                    <div class="fighter-team">{{if .Fighter2}}{{.Fighter2.Team}}{{end}}</div>
                    {{if or (gt .Fighter2Blessings 0) (gt .Fighter2Curses 0)}}
                        <div class="fighter-effects">
                            {{if gt .Fighter2Blessings 0}}<span class="blessing-indicator">‚ú® {{.Fighter2Blessings}}</span>{{end}}
                            {{if gt .Fighter2Curses 0}}<span class="curse-indicator">üíÄ {{.Fighter2Curses}}</span>{{end}}
                        </div>
                    {{end}}
                </div>
                <div class="health-bar-container">
                    <div class="health-label">HEALTH</div>
                    <div class="health-bar">
                        <div class="health-fill" id="health2" style="width: 100%"></div>
                        <div class="health-text" id="health2-text">100,000</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Betting Information Section -->
        {{if .AllBets}}
        <div class="betting-section">
            <h3>üí∞ DEGENERATE GAMBLING STATUS</h3>
            {{if .UserBet}}
                <div class="user-bet-status">
                    <strong>Your Bet:</strong> {{.UserBet.Amount}} credits on 
                    {{if eq .UserBet.FighterID .Fight.Fighter1ID}}{{.Fight.Fighter1Name}}{{else}}{{.Fight.Fighter2Name}}{{end}}
                    {{if eq .UserBet.Status "resolved"}}
                        {{if .UserBet.Payout.Valid}}
                            - <span class="win-status">WON {{.UserBet.Payout.Int64}} credits! üéâ</span>
                        {{else}}
                            - <span class="loss-status">LOST üí∏</span>
                        {{end}}
                    {{end}}
                </div>
            {{end}}
            
            <div class="betting-summary">
                <div class="bet-count">{{len .AllBets}} degenerates have placed bets</div>
                {{$fighter1Bets := 0}}
                {{$fighter2Bets := 0}}
                {{$totalAmount := 0}}
                {{range .AllBets}}
                    {{$totalAmount = add $totalAmount .Amount}}
                    {{if eq .FighterID $.Fight.Fighter1ID}}
                        {{$fighter1Bets = add $fighter1Bets 1}}
                    {{else}}
                        {{$fighter2Bets = add $fighter2Bets 1}}
                    {{end}}
                {{end}}
                <div class="bet-stats-quick">
                    <span><strong>{{.Fight.Fighter1Name}}:</strong> {{$fighter1Bets}} bets</span> | 
                    <span><strong>{{.Fight.Fighter2Name}}:</strong> {{$fighter2Bets}} bets</span> | 
                    <span><strong>Total Wagered:</strong> {{$totalAmount}} credits</span>
                </div>
            </div>

            <div class="detailed-bets">
                <h4>üé≠ DEGENERATE ROSTER</h4>
                <div class="bets-list">
                    {{range .AllBets}}
                    <div class="bet-notification {{if eq .UserID $.User.ID}}user-bet{{end}}">
                        <div class="bet-main-line">
                            <span class="bettor-name">{{getDisplayName .Username .CustomUsername}}</span>
                            <span class="bet-info">
                                {{.Amount}} credits ‚Üí {{.FighterName}}
                                {{if eq .Status "resolved"}}
                                    {{if .Payout.Valid}}
                                        <span class="win-badge">+{{.Payout.Int64}}</span>
                                    {{else}}
                                        <span class="loss-badge">LOST</span>
                                    {{end}}
                                {{end}}
                            </span>
                        </div>
                        <!-- Show effects applied by this user as separate notification lines -->
                        {{$userID := .UserID}}
                        {{range $.UserEffectsOnFight}}
                            {{if eq .UserID $userID}}
                            <div class="effect-notification {{if eq .EffectType "fighter_blessing"}}blessing-notif{{else}}curse-notif{{end}}">
                                {{if eq .EffectType "fighter_blessing"}}
                                    ‚ú® Applied blessing to {{.TargetName}}
                                {{else if eq .EffectType "fighter_curse"}}
                                    üíÄ Applied curse to {{.TargetName}}
                                {{end}}
                            </div>
                            {{end}}
                        {{end}}
                    </div>
                    {{end}}
                </div>
            </div>
        </div>
        {{end}}

        <div class="watch-controls">
            <a href="/fight/{{.Fight.ID}}" class="control-button">‚Üê Fight Details</a>
            <a href="/" class="control-button">‚Üê Schedule</a>
        </div>

        <script src="/static/js/watch.js"></script>
        <script>
            // Initialize the Violence Theater
            document.addEventListener('DOMContentLoaded', function() {
                const fightData = {
                    id: {{.Fight.ID}},
                    status: "{{.Fight.Status}}",
                    fighter1Name: "{{.Fight.Fighter1Name}}",
                    fighter2Name: "{{.Fight.Fighter2Name}}",
                    {{if .Fight.FinalScore1.Valid}}finalHealth1: {{.Fight.FinalScore1.Int64}},{{else}}finalHealth1: 100000,{{end}}
                    {{if .Fight.FinalScore2.Valid}}finalHealth2: {{.Fight.FinalScore2.Int64}},{{else}}finalHealth2: 100000,{{end}}
                    {{if .Fight.WinnerID.Valid}}winnerID: {{.Fight.WinnerID.Int64}},
                    fighter1ID: {{.Fight.Fighter1ID}},
                    fighter2ID: {{.Fight.Fighter2ID}}{{end}}
                };
                
                initializeWatchPage({{.Fight.ID}}, fightData);
            });
        </script>
    {{else}}
        <div class="error-section">
            <h2>üíÄ VIOLENCE NOT FOUND</h2>
            <p>The requested violence event has been absorbed into the chaos void.</p>
            <div style="margin-top: 20px;">
                <a href="/" class="control-button">‚Üê Return to Schedule</a>
            </div>
        </div>
    {{end}}
</div>
{{end}} 