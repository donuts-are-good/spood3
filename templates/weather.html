{{define "content"}}
<div class="weather-absurd">
  <header class="wa-hero">
    <h2>Recreational Meteorology</h2>
    <p class="wa-sub">Filed by the Department · Deterministic yet unreasonable</p>
    {{if .ShowHistoricalBanner}}
    <div class="wa-banner">
      <strong>Department Notice:</strong> Prior to {{formatDate .NetworkStart}}, the public Weather Network did not exist. Records shown for earlier weeks are retrospectively reconstructed from quantum indices and departmental ledgers. See <a href="/blog/posts/2025-10-04-weather-advisory" class="wa-link">Weather Advisory</a> for context.
    </div>
    {{end}}
    <div id="chaosWeatherAdvisory" class="chaos-weather-advisory">
      <div class="advisory-content">
        <div class="advisory-icon" aria-hidden="true">⚠️</div>
        <div class="advisory-text">
          <div class="advisory-title">TEMPORAL WEATHER WARNING</div>
          <p class="advisory-body" data-echo="An unknown temporal displacement agent blew in on the eastern tradewinds, causing microwave dinners to explode as they're stuck in time dilation, making wives age prematurely, and giving everyone a queasy feeling in their giblets with incontrollable shits. One engineer said he took on coffee poop, and before he could exit the copy room he had to take another coffeeshit, and Brenda the receptionist watched her Irish coffee evaporate before her eyes.">
            An unknown temporal displacement agent blew in on the eastern tradewinds, causing microwave dinners to explode as they're stuck in time dilation, making wives age prematurely, and giving everyone a queasy feeling in their giblets with incontrollable shits. One engineer said he took on coffee poop, and before he could exit the copy room he had to take another coffeeshit, and Brenda the receptionist watched her Irish coffee evaporate before her eyes.
          </p>
        </div>
        <button type="button" class="advisory-dismiss" aria-label="Dismiss temporal weather warning" onclick="dismissWeatherAdvisory()">×</button>
      </div>
    </div>
    <div class="wa-headline">
      <div>
        <span class="hl-k">Week:</span>
        <span class="hl-v">{{if .Tournament}}#{{.Tournament.WeekNumber}}{{else}}—{{end}}</span>
        <span class="hl-sep">·</span>
        <span class="hl-k">Tournament:</span>
        <span class="hl-v">{{if .Tournament}}{{.Tournament.Name}}{{else}}—{{end}}</span>
        <span class="hl-sep">·</span>
        <span class="hl-k">Sponsor:</span>
        <span class="hl-v">{{if .Tournament}}{{.Tournament.Sponsor}}{{else}}—{{end}}</span>
      </div>
      <div>
        <span class="hl-k">Week Start:</span>
        <span class="hl-v">{{if .WeeklyWeather}}{{formatDate .WeeklyWeather.WeekStart}}{{else}}—{{end}}</span>
        <span class="hl-sep">·</span>
        <span class="hl-k">Today:</span>
        <span class="hl-v">{{formatDate .Now}}</span>
      </div>
    </div>
  </header>

  <div class="wa-grid">
    <a class="wx-nav wx-nav-left" href="/weather?date={{formatDateParam (addDays .Now -1)}}" title="Previous day">‹</a>
    {{if .ShowNextNav}}
    <a class="wx-nav wx-nav-right" href="/weather?date={{formatDateParam (addDays .Now 1)}}" title="Next day">›</a>
    {{end}}
    <div class="wa-col">
      <div class="wa-pan" id="today-card">
        <div class="wa-h">Today</div>
        <div class="wa-kv" id="today-kv"></div>
      </div>
      <div class="wa-pan" id="wind-card">
        <div class="wa-h">Wind</div>
        <svg id="wind-compass" viewBox="0 0 160 160"></svg>
      </div>
      <div class="wa-pan" id="labels-card">
        <div class="wa-h">This Week</div>
        <div class="wa-kv">
          <div class="kv-item"><span class="k">Biome</span><span class="v" id="kv-biome">—</span></div>
          <div class="kv-item"><span class="k">Pizza</span><span class="v" id="kv-pizza">—</span></div>
          <div class="kv-item"><span class="k">Officials</span><span class="v" id="kv-off">—</span></div>
          <div class="kv-item"><span class="k">Cheese</span><span class="v" id="kv-cheese">—</span></div>
          <div class="kv-item"><span class="k">Time‑Mode</span><span class="v" id="kv-time">—</span></div>
        </div>
        <div class="wa-kv compact" id="weekly-kv"></div>
      </div>
    </div>

    <div class="wa-col">
      <div class="wa-pan" id="weekly-chart">
        <div class="wa-h">Weekly — Temp, Visc, Precip</div>
        <div class="legend" id="legend-mini"></div>
        <svg id="mini-weekly" viewBox="0 0 600 180" preserveAspectRatio="xMidYMid meet"></svg>
        <div class="wx-tip" id="wx-tip"></div>
      </div>
      <div class="wa-pan" id="forecast-card">
        <div class="wa-h">7‑Day Forecast</div>
        <table class="wx-table" id="forecast-table"></table>
      </div>
      <div class="wa-pan" id="counts-card">
        <div class="wa-h">Counts</div>
        <ul class="wx-list compact" id="counts-list"></ul>
      </div>
      <div class="wa-pan" id="events-card">
        <div class="wa-h">Events</div>
        <ul class="wx-list" id="events-list"></ul>
      </div>
    </div>
  </div>

  <script>
    window.__WEATHER__ = {
      weekly: {{json .WeeklyWeather}},
      today: {{json .DailyWeather}},
      series: {{json .DailySeries}}
    };
  </script>
  <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
  <script src="/static/js/weather.js"></script>
</div>
{{end}}

